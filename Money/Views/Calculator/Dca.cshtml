@{
    ViewData["Title"] = "å®šæœŸå®šé¡è¤‡åˆ©è¨ˆç®—æ©Ÿ";
}

<div class="calculator-page">
    <div class="container py-5">
        <div id="app" class="d-flex justify-content-center">
            <div class="card shadow-lg rounded-lg calculator-card p-4 p-md-5">
                <div class="card-body">
                    <h1 class="card-title text-center h3 mb-4">å®šæœŸå®šé¡è¤‡åˆ©è¨ˆç®—æ©Ÿ ğŸš€</h1>

                    <form v-on:submit.prevent="calculate" novalidate>
                        <div class="mb-4">
                            <label for="monthlyInvestment" class="form-label fw-bold text-secondary">æœˆæŠ•å…¥é‡‘é¡ (NTD)</label>
                            <input type="number" id="monthlyInvestment" class="form-control form-control-lg" 
                                   v-model.number="form.monthlyInvestment"
                                   v-bind:class="{ 'is-invalid': errors.monthlyInvestment }"
                                   aria-label="è¼¸å…¥æ¯æœˆæŠ•å…¥é‡‘é¡"
                                   required>
                            <div v-if="errors.monthlyInvestment" class="invalid-feedback fade-in" role="alert">{{ errors.monthlyInvestment }}</div>
                        </div>

                        <div class="mb-4">
                            <label for="annualRate" class="form-label fw-bold text-secondary">é æœŸå¹´åŒ–å ±é…¬ç‡ (%)</label>
                            <select id="annualRate" class="form-select form-select-lg" 
                                    v-model.number="form.annualRate" 
                                    aria-label="é¸æ“‡é æœŸå¹´åŒ–å ±é…¬ç‡">
                                <option v-for="rate in annualRates" :value="rate">{{ rate }}%</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="years" class="form-label fw-bold text-secondary">æŠ•è³‡å¹´æ•¸</label>
                            <input type="number" id="years" class="form-control form-control-lg" 
                                   v-model.number="form.years"
                                   v-bind:class="{ 'is-invalid': errors.years }"
                                   aria-label="è¼¸å…¥æŠ•è³‡å¹´æ•¸"
                                   required>
                            <div class="form-text">è«‹è¼¸å…¥ 1 åˆ° 50 ä¹‹é–“çš„å¹´æ•¸ã€‚</div>
                            <div v-if="errors.years" class="invalid-feedback fade-in" role="alert">{{ errors.years }}</div>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" 
                                    v-bind:disabled="!isValid || loading"
                                    aria-label="è¨ˆç®—å®šæœŸå®šé¡è¤‡åˆ©çµæœ">
                                <span v-if="loading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                {{ loading ? 'è¨ˆç®—ä¸­...' : 'é¦¬ä¸Šè¨ˆç®—' }}
                            </button>
                        </div>
                    </form>

                    <div v-if="result" class="mt-5 fade-in" id="result-section">
                        <div class="card result-card rounded-lg p-4">
                            <div class="text-center">
                                <div class="result-label">æœ€çµ‚è³‡ç”¢</div>
                                <div class="result-value" aria-describedby="result-description">{{ formatCurrency(result.totalValue) }}</div>
                            </div>
                            <hr class="my-3">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="result-label">ç¸½æŠ•å…¥æœ¬é‡‘</div>
                                    <div>{{ formatCurrency(result.totalInvested) }}</div>
                                </div>
                                <div class="text-end">
                                    <div class="result-label result-return">æŠ•è³‡å ±é…¬ â†‘</div>
                                    <div class="result-return">{{ formatCurrency(result.totalReturn) }}</div>
                                </div>
                            </div>
                        </div>

                        <p id="result-description" class="visually-hidden">
                            è¨ˆç®—çµæœï¼šæœ€çµ‚è³‡ç”¢ç‚º {{ formatCurrency(result.totalValue) }} å…ƒï¼Œ
                            ç¸½æŠ•å…¥æœ¬é‡‘ç‚º {{ formatCurrency(result.totalInvested) }} å…ƒï¼Œ
                            ç¸½æŠ•è³‡å ±é…¬ç‚º {{ formatCurrency(result.totalReturn) }} å…ƒã€‚
                        </p>

                        <!-- Chart Section -->
                        <div class="mt-4">
                            <canvas id="dca-chart" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/dca-calculator.js" asp-append-version="true"></script>
}
